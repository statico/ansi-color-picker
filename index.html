<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Interactive ANSI 256 color picker - Find the closest terminal color for any color you select">
  <meta name="keywords" content="ANSI, terminal, color picker, 256 colors, HSV, color tool">
  <meta name="author" content="Ian Langworth">
  <meta property="og:title" content="ANSI Color Picker">
  <meta property="og:description" content="Interactive tool for finding the closest ANSI 256 terminal colors">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://statico.github.io/ansi-color-picker/">
  <title>ANSI Color Picker - Find Terminal Colors</title>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* Custom styles for better color picker experience */
    .color-picker-cursor {
      box-shadow: 0 0 0 2px white, 0 0 0 3px black;
    }
    body {
      background-color: #111;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useMemo, useCallback, useRef, useEffect } = React;
    
    const AnsiHSVColorPicker = () => {
  const [selectedColor, setSelectedColor] = useState({ h: 0, s: 100, v: 100 });
  const [closestAnsi, setClosestAnsi] = useState(null);
  const [isDragging, setIsDragging] = useState(null);
  const [theme, setTheme] = useState(() => {
    // Check localStorage first
    const saved = localStorage.getItem('theme');
    if (saved) return saved;
    // Default to system
    return 'system';
  });
  
  const svCanvasRef = useRef(null);
  const hueCanvasRef = useRef(null);
  
  // Determine actual theme based on theme setting and system preference
  const getActualTheme = useCallback(() => {
    if (theme === 'system') {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    return theme;
  }, [theme]);
  
  const actualTheme = getActualTheme();
  
  // Apply theme to body
  useEffect(() => {
    const root = document.documentElement;
    if (actualTheme === 'light') {
      root.style.backgroundColor = '#f0f0f0';
      document.body.style.backgroundColor = '#f0f0f0';
    } else {
      root.style.backgroundColor = '#111';
      document.body.style.backgroundColor = '#111';
    }
  }, [actualTheme]);
  
  // Save theme preference
  useEffect(() => {
    localStorage.setItem('theme', theme);
  }, [theme]);
  
  // Listen for system theme changes
  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    const handler = () => {
      if (theme === 'system') {
        // Force re-render when system preference changes
        setTheme('system');
      }
    };
    mediaQuery.addEventListener('change', handler);
    return () => mediaQuery.removeEventListener('change', handler);
  }, [theme]);

  // ANSI 256 color palette with RGB values
  const ansiColors = useMemo(() => {
    const colors = [];
    
    // Standard 16 colors (0-15)
    const standard16 = [
      [0, 0, 0], [128, 0, 0], [0, 128, 0], [128, 128, 0], 
      [0, 0, 128], [128, 0, 128], [0, 128, 128], [192, 192, 192],
      [128, 128, 128], [255, 0, 0], [0, 255, 0], [255, 255, 0], 
      [0, 0, 255], [255, 0, 255], [0, 255, 255], [255, 255, 255]
    ];
    
    // 216 color cube (16-231)
    const values = [0, 95, 135, 175, 215, 255];
    for (let r = 0; r < 6; r++) {
      for (let g = 0; g < 6; g++) {
        for (let b = 0; b < 6; b++) {
          colors.push([values[r], values[g], values[b]]);
        }
      }
    }
    
    // Grayscale ramp (232-255)
    for (let i = 0; i < 24; i++) {
      const value = Math.round(8 + i * 10);
      colors.push([value, value, value]);
    }
    
    // Add standard 16 at the beginning
    return [...standard16.map((rgb, i) => ({ index: i, rgb })), 
            ...colors.slice(16).map((rgb, i) => ({ index: i + 16, rgb }))];
  }, []);

  // Convert HSV to RGB
  const hsvToRgb = useCallback((h, s, v) => {
    h = h / 360;
    s = s / 100;
    v = v / 100;
    
    const c = v * s;
    const x = c * (1 - Math.abs(((h * 6) % 2) - 1));
    const m = v - c;
    
    let r, g, b;
    if (h < 1/6) {
      [r, g, b] = [c, x, 0];
    } else if (h < 2/6) {
      [r, g, b] = [x, c, 0];
    } else if (h < 3/6) {
      [r, g, b] = [0, c, x];
    } else if (h < 4/6) {
      [r, g, b] = [0, x, c];
    } else if (h < 5/6) {
      [r, g, b] = [x, 0, c];
    } else {
      [r, g, b] = [c, 0, x];
    }
    
    return [
      Math.round((r + m) * 255),
      Math.round((g + m) * 255),
      Math.round((b + m) * 255)
    ];
  }, []);

  // Calculate color distance (Delta E CIE76 approximation)
  const colorDistance = useCallback((rgb1, rgb2) => {
    const [r1, g1, b1] = rgb1;
    const [r2, g2, b2] = rgb2;
    
    // Simple Euclidean distance in RGB space
    const dr = r1 - r2;
    const dg = g1 - g2;
    const db = b1 - b2;
    
    // Weight red, green, blue differently (human eye sensitivity)
    return Math.sqrt(2 * dr * dr + 4 * dg * dg + 3 * db * db);
  }, []);

  // Find closest ANSI color
  const findClosestAnsiColor = useCallback((targetRgb) => {
    let minDistance = Infinity;
    let closest = null;
    
    ansiColors.forEach(color => {
      const distance = colorDistance(targetRgb, color.rgb);
      if (distance < minDistance) {
        minDistance = distance;
        closest = color;
      }
    });
    
    return closest;
  }, [ansiColors, colorDistance]);

  // Update closest ANSI color when HSV changes
  useEffect(() => {
    const rgb = hsvToRgb(selectedColor.h, selectedColor.s, selectedColor.v);
    const closest = findClosestAnsiColor(rgb);
    setClosestAnsi(closest);
  }, [selectedColor, hsvToRgb, findClosestAnsiColor]);

  // Draw saturation/value canvas
  useEffect(() => {
    const canvas = svCanvasRef.current;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const { width, height } = canvas;
    
    const imageData = ctx.createImageData(width, height);
    const data = imageData.data;
    
    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        const s = (x / width) * 100;
        const v = ((height - y) / height) * 100;
        const [r, g, b] = hsvToRgb(selectedColor.h, s, v);
        
        const index = (y * width + x) * 4;
        data[index] = r;
        data[index + 1] = g;
        data[index + 2] = b;
        data[index + 3] = 255;
      }
    }
    
    ctx.putImageData(imageData, 0, 0);
  }, [selectedColor.h, hsvToRgb]);

  // Draw hue canvas
  useEffect(() => {
    const canvas = hueCanvasRef.current;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const { width, height } = canvas;
    
    const imageData = ctx.createImageData(width, height);
    const data = imageData.data;
    
    for (let y = 0; y < height; y++) {
      const h = (y / height) * 360;
      const [r, g, b] = hsvToRgb(h, 100, 100);
      
      for (let x = 0; x < width; x++) {
        const index = (y * width + x) * 4;
        data[index] = r;
        data[index + 1] = g;
        data[index + 2] = b;
        data[index + 3] = 255;
      }
    }
    
    ctx.putImageData(imageData, 0, 0);
  }, [hsvToRgb]);

  // Handle mouse events
  const handleSVMouseDown = (e) => {
    setIsDragging('sv');
    handleSVMouseMove(e);
  };

  const handleSVMouseMove = (e) => {
    if (isDragging !== 'sv' && e.type === 'mousemove') return;
    
    const rect = svCanvasRef.current.getBoundingClientRect();
    const x = Math.max(0, Math.min(rect.width, e.clientX - rect.left));
    const y = Math.max(0, Math.min(rect.height, e.clientY - rect.top));
    
    const s = (x / rect.width) * 100;
    const v = ((rect.height - y) / rect.height) * 100;
    
    setSelectedColor(prev => ({ ...prev, s, v }));
  };

  const handleHueMouseDown = (e) => {
    setIsDragging('hue');
    handleHueMouseMove(e);
  };

  const handleHueMouseMove = (e) => {
    if (isDragging !== 'hue' && e.type === 'mousemove') return;
    
    const rect = hueCanvasRef.current.getBoundingClientRect();
    const y = Math.max(0, Math.min(rect.height, e.clientY - rect.top));
    const h = (y / rect.height) * 360;
    
    setSelectedColor(prev => ({ ...prev, h }));
  };

  const handleMouseUp = () => {
    setIsDragging(null);
  };

  // Add global mouse events
  useEffect(() => {
    const handleGlobalMouseMove = (e) => {
      if (isDragging === 'sv') handleSVMouseMove(e);
      if (isDragging === 'hue') handleHueMouseMove(e);
    };

    if (isDragging) {
      document.addEventListener('mousemove', handleGlobalMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
    }

    return () => {
      document.removeEventListener('mousemove', handleGlobalMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
    };
  }, [isDragging]);

  // Convert RGB to HSV
  const rgbToHsv = useCallback((r, g, b) => {
    r /= 255;
    g /= 255;
    b /= 255;
    
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    const diff = max - min;
    
    let h = 0;
    if (diff !== 0) {
      switch (max) {
        case r: h = ((g - b) / diff) % 6; break;
        case g: h = (b - r) / diff + 2; break;
        case b: h = (r - g) / diff + 4; break;
      }
    }
    h = Math.round(h * 60);
    if (h < 0) h += 360;
    
    const s = max === 0 ? 0 : Math.round((diff / max) * 100);
    const v = Math.round(max * 100);
    
    return { h, s, v };
  }, []);

  // Handle hex input
  const [hexInput, setHexInput] = useState('');
  
  const handleHexChange = (e) => {
    let value = e.target.value;
    if (!value.startsWith('#')) value = '#' + value;
    setHexInput(value);
    
    // Validate and convert hex to HSV
    const hexRegex = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;
    if (hexRegex.test(value)) {
      let hex = value.slice(1);
      if (hex.length === 3) {
        hex = hex.split('').map(c => c + c).join('');
      }
      
      const r = parseInt(hex.slice(0, 2), 16);
      const g = parseInt(hex.slice(2, 4), 16);
      const b = parseInt(hex.slice(4, 6), 16);
      
      const hsv = rgbToHsv(r, g, b);
      setSelectedColor(hsv);
    }
  };

  const currentRgb = hsvToRgb(selectedColor.h, selectedColor.s, selectedColor.v);
  const currentHex = `#${currentRgb.map(c => c.toString(16).padStart(2, '0')).join('')}`;
  const ansiHex = closestAnsi ? `#${closestAnsi.rgb.map(c => c.toString(16).padStart(2, '0')).join('')}` : '';
  
  // Update hex input when color changes (but only if user isn't currently typing)
  useEffect(() => {
    if (document.activeElement?.id !== 'hex-input') {
      setHexInput(currentHex);
    }
  }, [currentHex]);

  return (
    <div className={`min-h-screen p-8 ${actualTheme === 'light' ? 'text-gray-900' : 'text-white'}`}>
      <div className="max-w-4xl mx-auto">
        {/* Theme Switcher */}
        <div className="flex justify-end mb-4">
          <div className={`inline-flex rounded-lg p-1 ${actualTheme === 'light' ? 'bg-gray-200' : 'bg-gray-800'}`}>
            <button
              onClick={() => setTheme('light')}
              className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${
                theme === 'light' 
                  ? (actualTheme === 'light' ? 'bg-white text-gray-900 shadow-sm' : 'bg-gray-700 text-white') 
                  : (actualTheme === 'light' ? 'text-gray-600 hover:text-gray-900' : 'text-gray-400 hover:text-white')
              }`}
              title="Light theme"
            >
              ‚òÄÔ∏è
            </button>
            <button
              onClick={() => setTheme('dark')}
              className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${
                theme === 'dark'
                  ? (actualTheme === 'light' ? 'bg-white text-gray-900 shadow-sm' : 'bg-gray-700 text-white')
                  : (actualTheme === 'light' ? 'text-gray-600 hover:text-gray-900' : 'text-gray-400 hover:text-white')
              }`}
              title="Dark theme"
            >
              üåô
            </button>
            <button
              onClick={() => setTheme('system')}
              className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${
                theme === 'system'
                  ? (actualTheme === 'light' ? 'bg-white text-gray-900 shadow-sm' : 'bg-gray-700 text-white')
                  : (actualTheme === 'light' ? 'text-gray-600 hover:text-gray-900' : 'text-gray-400 hover:text-white')
              }`}
              title="System theme"
            >
              üíª
            </button>
          </div>
        </div>
        
        <h1 className="text-3xl font-bold mb-8 text-center">ANSI 256 HSV Color Picker</h1>
        
        <div className="flex flex-col lg:flex-row gap-8">
          {/* Color Picker */}
          <div className="flex-1">
            <div className={`p-6 rounded-lg ${actualTheme === 'light' ? 'bg-white border border-gray-200' : 'bg-gray-800'}`}>
              <h2 className="text-xl font-semibold mb-4">Pick a Color</h2>
              
              <div className="flex gap-4">
                {/* Saturation/Value Canvas */}
                <div className="relative">
                  <canvas
                    ref={svCanvasRef}
                    width={256}
                    height={256}
                    className={`border cursor-crosshair ${actualTheme === 'light' ? 'border-gray-400' : 'border-gray-600'}`}
                    onMouseDown={handleSVMouseDown}
                    onMouseMove={handleSVMouseMove}
                  />
                  {/* SV Cursor */}
                  <div
                    className="absolute w-3 h-3 border-2 border-white rounded-full pointer-events-none transform -translate-x-1/2 -translate-y-1/2"
                    style={{
                      left: `${(selectedColor.s / 100) * 256}px`,
                      top: `${((100 - selectedColor.v) / 100) * 256}px`,
                      boxShadow: '0 0 0 1px black'
                    }}
                  />
                </div>
                
                {/* Hue Canvas */}
                <div className="relative">
                  <canvas
                    ref={hueCanvasRef}
                    width={30}
                    height={256}
                    className={`border cursor-crosshair ${actualTheme === 'light' ? 'border-gray-400' : 'border-gray-600'}`}
                    onMouseDown={handleHueMouseDown}
                    onMouseMove={handleHueMouseMove}
                  />
                  {/* Hue Cursor */}
                  <div
                    className="absolute w-8 h-1 border border-white pointer-events-none transform -translate-y-1/2"
                    style={{
                      top: `${(selectedColor.h / 360) * 256}px`,
                      left: '-4px',
                      backgroundColor: 'black',
                      boxShadow: '0 0 0 1px white'
                    }}
                  />
                </div>
              </div>
              
              {/* Hex Input */}
              <div className="mt-4">
                <label className={`block mb-2 text-sm ${actualTheme === 'light' ? 'text-gray-600' : 'text-gray-400'}`}>Hex Color</label>
                <input
                  id="hex-input"
                  type="text"
                  value={hexInput}
                  onChange={handleHexChange}
                  placeholder="#ff0000"
                  className={`w-full px-3 py-2 rounded border focus:border-blue-500 focus:outline-none font-mono ${actualTheme === 'light' ? 'bg-gray-100 text-gray-900 border-gray-300' : 'bg-gray-700 text-white border-gray-600'}`}
                />
              </div>
              
              {/* HSV Values */}
              <div className="mt-4 grid grid-cols-3 gap-4 text-sm">
                <div>
                  <label className={`block mb-1 ${actualTheme === 'light' ? 'text-gray-600' : 'text-gray-400'}`}>Hue</label>
                  <div className={`px-3 py-2 rounded ${actualTheme === 'light' ? 'bg-gray-100' : 'bg-gray-700'}`}>{Math.round(selectedColor.h)}¬∞</div>
                </div>
                <div>
                  <label className={`block mb-1 ${actualTheme === 'light' ? 'text-gray-600' : 'text-gray-400'}`}>Saturation</label>
                  <div className={`px-3 py-2 rounded ${actualTheme === 'light' ? 'bg-gray-100' : 'bg-gray-700'}`}>{Math.round(selectedColor.s)}%</div>
                </div>
                <div>
                  <label className={`block mb-1 ${actualTheme === 'light' ? 'text-gray-600' : 'text-gray-400'}`}>Value</label>
                  <div className={`px-3 py-2 rounded ${actualTheme === 'light' ? 'bg-gray-100' : 'bg-gray-700'}`}>{Math.round(selectedColor.v)}%</div>
                </div>
              </div>
            </div>
          </div>
          
          {/* Color Comparison */}
          <div className="flex-1">
            <div className={`p-6 rounded-lg ${actualTheme === 'light' ? 'bg-white border border-gray-200' : 'bg-gray-800'}`}>
              <h2 className="text-xl font-semibold mb-4">Color Comparison</h2>
              
              <div className="space-y-4">
                {/* Selected Color */}
                <div>
                  <h3 className={`text-sm font-medium mb-2 ${actualTheme === 'light' ? 'text-gray-600' : 'text-gray-400'}`}>Your Selection</h3>
                  <div className="flex items-center space-x-4">
                    <div 
                      className={`w-16 h-16 rounded border ${actualTheme === 'light' ? 'border-gray-400' : 'border-gray-600'}`}
                      style={{ backgroundColor: currentHex }}
                    />
                    <div className="text-sm font-mono">
                      <div>RGB: {currentRgb.join(', ')}</div>
                      <div>Hex: {currentHex}</div>
                      <div>HSV: {Math.round(selectedColor.h)}¬∞, {Math.round(selectedColor.s)}%, {Math.round(selectedColor.v)}%</div>
                    </div>
                  </div>
                </div>
                
                {/* Closest ANSI Color */}
                {closestAnsi && (
                  <div>
                    <h3 className={`text-sm font-medium mb-2 ${actualTheme === 'light' ? 'text-gray-600' : 'text-gray-400'}`}>Closest ANSI Color</h3>
                    <div className="flex items-center space-x-4">
                      <div 
                        className={`w-16 h-16 rounded border ${actualTheme === 'light' ? 'border-gray-400' : 'border-gray-600'}`}
                        style={{ backgroundColor: ansiHex }}
                      />
                      <div className="text-sm font-mono">
                        <div>ANSI: {closestAnsi.index}</div>
                        <div>RGB: {closestAnsi.rgb.join(', ')}</div>
                        <div>Hex: {ansiHex}</div>
                      </div>
                    </div>
                  </div>
                )}
                
                {/* Terminal Usage */}
                {closestAnsi && (
                  <div className={`mt-6 pt-4 border-t ${actualTheme === 'light' ? 'border-gray-300' : 'border-gray-700'}`}>
                    <h3 className={`text-sm font-medium mb-2 ${actualTheme === 'light' ? 'text-gray-600' : 'text-gray-400'}`}>Terminal Usage</h3>
                    <div className={`p-3 rounded text-xs font-mono space-y-1 ${actualTheme === 'light' ? 'bg-gray-100' : 'bg-gray-700'}`}>
                      <div>Foreground: <span className="text-green-400">\033[38;5;{closestAnsi.index}m</span></div>
                      <div>Background: <span className="text-green-400">\033[48;5;{closestAnsi.index}m</span></div>
                      <div>Reset: <span className="text-green-400">\033[0m</span></div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
        
        {/* Instructions */}
        <div className={`mt-8 text-center ${actualTheme === 'light' ? 'text-gray-600' : 'text-gray-400'}`}>
          <p className="text-sm">
            Click and drag on the color square to adjust saturation and value. 
            Use the hue strip to change the hue. The picker will automatically find the closest ANSI 256 color.
          </p>
        </div>
      </div>
    </div>
  );
};

    // Render the component
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(AnsiHSVColorPicker));
  </script>
</body>
</html>